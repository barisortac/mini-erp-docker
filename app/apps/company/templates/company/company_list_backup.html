{% extends 'layouts/base.html' %}
{% load i18n %}
{% load static %}

{% block title %} Tables {% endblock title %}

{% block content %}

    <!-- Main content -->
    <div class="main-content" id="panel">
        <!-- Topnav -->
{#        <nav class="navbar navbar-top navbar-expand navbar-dark bg-primary border-bottom">#}
{#            <div class="container-fluid">#}
{#                <div class="collapse navbar-collapse"#}
{#                     id="navbarSupportedContent">#}
{#                    <!-- Search form -->#}
{#                    <!-- Navbar links -->#}
{#                    <ul class="navbar-nav align-items-center ml-md-auto">#}
{#                        <li class="nav-item d-xl-none">#}
{#                            <!-- Sidenav toggler -->#}
{#                            <div class="pr-3 sidenav-toggler sidenav-toggler-dark"#}
{#                                 data-action="sidenav-pin"#}
{#                                 data-target="#sidenav-main">#}
{#                                <div class="sidenav-toggler-inner">#}
{#                                    <i class="sidenav-toggler-line"></i>#}
{#                                    <i class="sidenav-toggler-line"></i>#}
{#                                    <i class="sidenav-toggler-line"></i>#}
{#                                </div>#}
{#                            </div>#}
{#                        </li>#}
{#                        <li class="nav-item d-sm-none">#}
{#                            <a class="nav-link" href="#"#}
{#                               data-action="search-show"#}
{#                               data-target="#navbar-search-main">#}
{#                                <i class="ni ni-zoom-split-in"></i>#}
{#                            </a>#}
{#                        </li>#}
{#                        <li class="nav-item dropdown">#}
{#                            <a class="nav-link" href="#" role="button"#}
{#                               data-toggle="dropdown" aria-haspopup="true"#}
{#                               aria-expanded="false">#}
{#                                <i class="ni ni-bell-55"></i>#}
{#                            </a>#}
{#                            <div class="dropdown-menu dropdown-menu-xl dropdown-menu-right py-0 overflow-hidden">#}
{#                                <!-- Dropdown header -->#}
{#                                <div class="px-3 py-3">#}
{#                                    <h6 class="text-sm text-muted m-0">You have#}
{#                                        <strong class="text-primary">13</strong>#}
{#                                        notifications.</h6>#}
{#                                </div>#}
{#                                <!-- List group -->#}
{#                                <div class="list-group list-group-flush">#}
{#                                    <a href="#!"#}
{#                                       class="list-group-item list-group-item-action">#}
{#                                        <div class="row align-items-center">#}
{#                                            <div class="col-auto">#}
{#                                                <!-- Avatar -->#}
{#                                                <img alt="Image placeholder"#}
{#                                                     src="../../assets/img/theme/team-1.jpg"#}
{#                                                     class="avatar rounded-circle">#}
{#                                            </div>#}
{#                                            <div class="col ml--2">#}
{#                                                <div class="d-flex justify-content-between align-items-center">#}
{#                                                    <div>#}
{#                                                        <h4 class="mb-0 text-sm">#}
{#                                                            John Snow</h4>#}
{#                                                    </div>#}
{#                                                    <div class="text-right text-muted">#}
{#                                                        <small>2 hrs ago</small>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <p class="text-sm mb-0">Let's#}
{#                                                    meet at Starbucks at 11:30.#}
{#                                                    Wdyt?</p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                    <a href="#!"#}
{#                                       class="list-group-item list-group-item-action">#}
{#                                        <div class="row align-items-center">#}
{#                                            <div class="col-auto">#}
{#                                                <!-- Avatar -->#}
{#                                                <img alt="Image placeholder"#}
{#                                                     src="../../assets/img/theme/team-2.jpg"#}
{#                                                     class="avatar rounded-circle">#}
{#                                            </div>#}
{#                                            <div class="col ml--2">#}
{#                                                <div class="d-flex justify-content-between align-items-center">#}
{#                                                    <div>#}
{#                                                        <h4 class="mb-0 text-sm">#}
{#                                                            John Snow</h4>#}
{#                                                    </div>#}
{#                                                    <div class="text-right text-muted">#}
{#                                                        <small>3 hrs ago</small>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <p class="text-sm mb-0">A new#}
{#                                                    issue has been reported for#}
{#                                                    Argon.</p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                    <a href="#!"#}
{#                                       class="list-group-item list-group-item-action">#}
{#                                        <div class="row align-items-center">#}
{#                                            <div class="col-auto">#}
{#                                                <!-- Avatar -->#}
{#                                                <img alt="Image placeholder"#}
{#                                                     src="../../assets/img/theme/team-3.jpg"#}
{#                                                     class="avatar rounded-circle">#}
{#                                            </div>#}
{#                                            <div class="col ml--2">#}
{#                                                <div class="d-flex justify-content-between align-items-center">#}
{#                                                    <div>#}
{#                                                        <h4 class="mb-0 text-sm">#}
{#                                                            John Snow</h4>#}
{#                                                    </div>#}
{#                                                    <div class="text-right text-muted">#}
{#                                                        <small>5 hrs ago</small>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <p class="text-sm mb-0">Your#}
{#                                                    posts have been liked a#}
{#                                                    lot.</p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                    <a href="#!"#}
{#                                       class="list-group-item list-group-item-action">#}
{#                                        <div class="row align-items-center">#}
{#                                            <div class="col-auto">#}
{#                                                <!-- Avatar -->#}
{#                                                <img alt="Image placeholder"#}
{#                                                     src="../../assets/img/theme/team-4.jpg"#}
{#                                                     class="avatar rounded-circle">#}
{#                                            </div>#}
{#                                            <div class="col ml--2">#}
{#                                                <div class="d-flex justify-content-between align-items-center">#}
{#                                                    <div>#}
{#                                                        <h4 class="mb-0 text-sm">#}
{#                                                            John Snow</h4>#}
{#                                                    </div>#}
{#                                                    <div class="text-right text-muted">#}
{#                                                        <small>2 hrs ago</small>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <p class="text-sm mb-0">Let's#}
{#                                                    meet at Starbucks at 11:30.#}
{#                                                    Wdyt?</p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                    <a href="#!"#}
{#                                       class="list-group-item list-group-item-action">#}
{#                                        <div class="row align-items-center">#}
{#                                            <div class="col-auto">#}
{#                                                <!-- Avatar -->#}
{#                                                <img alt="Image placeholder"#}
{#                                                     src="../../assets/img/theme/team-5.jpg"#}
{#                                                     class="avatar rounded-circle">#}
{#                                            </div>#}
{#                                            <div class="col ml--2">#}
{#                                                <div class="d-flex justify-content-between align-items-center">#}
{#                                                    <div>#}
{#                                                        <h4 class="mb-0 text-sm">#}
{#                                                            John Snow</h4>#}
{#                                                    </div>#}
{#                                                    <div class="text-right text-muted">#}
{#                                                        <small>3 hrs ago</small>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                                <p class="text-sm mb-0">A new#}
{#                                                    issue has been reported for#}
{#                                                    Argon.</p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </a>#}
{#                                </div>#}
{#                                <!-- View all -->#}
{#                                <a href="#!"#}
{#                                   class="dropdown-item text-center text-primary font-weight-bold py-3">View#}
{#                                    all</a>#}
{#                            </div>#}
{#                        </li>#}
{#                        <li class="nav-item dropdown">#}
{#                            <a class="nav-link" href="#" role="button"#}
{#                               data-toggle="dropdown" aria-haspopup="true"#}
{#                               aria-expanded="false">#}
{#                                <i class="ni ni-ungroup"></i>#}
{#                            </a>#}
{#                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-dark bg-default dropdown-menu-right">#}
{#                                <div class="row shortcuts px-4">#}
{#                                    <a href="#!" class="col-4 shortcut-item">#}
{#                    <span class="shortcut-media avatar rounded-circle bg-gradient-red">#}
{#                      <i class="ni ni-calendar-grid-58"></i>#}
{#                    </span>#}
{#                                        <small>Calendar</small>#}
{#                                    </a>#}
{#                                    <a href="#!" class="col-4 shortcut-item">#}
{#                    <span class="shortcut-media avatar rounded-circle bg-gradient-orange">#}
{#                      <i class="ni ni-email-83"></i>#}
{#                    </span>#}
{#                                        <small>Email</small>#}
{#                                    </a>#}
{#                                    <a href="#!" class="col-4 shortcut-item">#}
{#                    <span class="shortcut-media avatar rounded-circle bg-gradient-info">#}
{#                      <i class="ni ni-credit-card"></i>#}
{#                    </span>#}
{#                                        <small>Payments</small>#}
{#                                    </a>#}
{#                                    <a href="#!" class="col-4 shortcut-item">#}
{#                    <span class="shortcut-media avatar rounded-circle bg-gradient-green">#}
{#                      <i class="ni ni-books"></i>#}
{#                    </span>#}
{#                                        <small>Reports</small>#}
{#                                    </a>#}
{#                                    <a href="#!" class="col-4 shortcut-item">#}
{#                    <span class="shortcut-media avatar rounded-circle bg-gradient-purple">#}
{#                      <i class="ni ni-pin-3"></i>#}
{#                    </span>#}
{#                                        <small>Maps</small>#}
{#                                    </a>#}
{#                                    <a href="#!" class="col-4 shortcut-item">#}
{#                    <span class="shortcut-media avatar rounded-circle bg-gradient-yellow">#}
{#                      <i class="ni ni-basket"></i>#}
{#                    </span>#}
{#                                        <small>Shop</small>#}
{#                                    </a>#}
{#                                </div>#}
{#                            </div>#}
{#                        </li>#}
{#                    </ul>#}
{#                    <ul class="navbar-nav align-items-center ml-auto ml-md-0">#}
{#                        <li class="nav-item dropdown">#}
{#                            <a class="nav-link pr-0" href="#" role="button"#}
{#                               data-toggle="dropdown" aria-haspopup="true"#}
{#                               aria-expanded="false">#}
{#                                <div class="media align-items-center">#}
{#                  <span class="avatar avatar-sm rounded-circle">#}
{#                    <img alt="Image placeholder"#}
{#                         src="../../assets/img/theme/team-4.jpg">#}
{#                  </span>#}
{#                                    <div class="media-body ml-2 d-none d-lg-block">#}
{#                                        <span class="mb-0 text-sm  font-weight-bold">John Snow</span>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </a>#}
{#                            <div class="dropdown-menu dropdown-menu-right">#}
{#                                <div class="dropdown-header noti-title">#}
{#                                    <h6 class="text-overflow m-0">Welcome!</h6>#}
{#                                </div>#}
{#                                <a href="#!" class="dropdown-item">#}
{#                                    <i class="ni ni-single-02"></i>#}
{#                                    <span>My profile</span>#}
{#                                </a>#}
{#                                <a href="#!" class="dropdown-item">#}
{#                                    <i class="ni ni-settings-gear-65"></i>#}
{#                                    <span>Settings</span>#}
{#                                </a>#}
{#                                <a href="#!" class="dropdown-item">#}
{#                                    <i class="ni ni-calendar-grid-58"></i>#}
{#                                    <span>Activity</span>#}
{#                                </a>#}
{#                                <a href="#!" class="dropdown-item">#}
{#                                    <i class="ni ni-support-16"></i>#}
{#                                    <span>Support</span>#}
{#                                </a>#}
{#                                <div class="dropdown-divider"></div>#}
{#                                <a href="#!" class="dropdown-item">#}
{#                                    <i class="ni ni-user-run"></i>#}
{#                                    <span>Logout</span>#}
{#                                </a>#}
{#                            </div>#}
{#                        </li>#}
{#                    </ul>#}
{#                </div>#}
{#            </div>#}
{#        </nav>#}
        <!-- Header -->
        <!-- Header -->
        <div class="header bg-primary pb-4">
            <div class="container-fluid">
                <div class="header-body">
                    <div class="row align-items-center py-4">
{#                        <div class="col-lg-6 col-7">#}
{#                            <h6 class="h2 text-white d-inline-block mb-0">#}
{#                                Datatables</h6>#}
{#                            <nav aria-label="breadcrumb"#}
{#                                 class="d-none d-md-inline-block ml-md-4">#}
{#                                <ol class="breadcrumb breadcrumb-links breadcrumb-dark">#}
{#                                    <li class="breadcrumb-item"><a href="#"><i#}
{#                                            class="fas fa-home"></i></a></li>#}
{#                                    <li class="breadcrumb-item"><a href="#">Tables</a>#}
{#                                    </li>#}
{#                                    <li class="breadcrumb-item active"#}
{#                                        aria-current="page">Datatables#}
{#                                    </li>#}
{#                                </ol>#}
{#                            </nav>#}
{#                        </div>#}
{#                        <div class="col-lg-6 col-5 text-right">#}
{#                            <a href="#" onclick="alert('hey');" class="btn btn-sm btn-neutral">New</a>#}
{#                            <a href="#"#}
{#                               class="btn btn-sm btn-neutral">Filters</a>#}
{#                        </div>#}
                    </div>
                </div>
            </div>
        </div>
        <!-- Page content -->
        <div class="container-fluid mt-2">
            <!-- Table -->
            <div class="row">
                <div class="col">
                    <div class="card">
                        <!-- Card header -->
                        <div class="card-header">
                            <h2 class="mb-0">Firmalar</h2>
                        </div>
                        <div class="table-responsive py-4">
                            <table class="table table-flush"
                                   id="datatable-basic">
                                <thead class="thead-light">
                                <tr>
                                    <th>İsim</th>
                                    <th>Kod</th>
                                    <th>Telefon</th>
                                    <th>ID</th>
                                    <th>Oluşturulma Zamanı</th>
{#                                    <th>Düzenle</th>#}
{#                                    <th>Sil</th>#}
                                </tr>
                                </thead>
{#                                <tbody></tbody>#}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <footer class="footer pt-0">
                <div class="row align-items-center justify-content-lg-between">
                    <div class="col-lg-6">
                        <div class="copyright text-center text-lg-left text-muted">
                            &copy; 2019 <a href="https://www.creative-tim.com"
                                           class="font-weight-bold ml-1"
                                           target="_blank">Creative Tim</a>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com"
                                   class="nav-link" target="_blank">Creative
                                    Tim</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com/presentation"
                                   class="nav-link" target="_blank">About Us</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://blog.creative-tim.com"
                                   class="nav-link" target="_blank">Blog</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.creative-tim.com/license"
                                   class="nav-link" target="_blank">License</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    {% for c in company_list %}
    <div class="text-center">
      <!-- Read book buttons -->
      <button type="button" id="read-book" class="bs-modal btn btn-sm btn-primary" data-form-url="{% url 'read-company' c.pk %}">
        <span class="fa fa-eye">{{ c.name }}</span>
      </button>
      <!-- Update book buttons -->
      <button type="button" id="update-booksdsd" class="bs-modal btn btn-sm btn-primary" data-form-url="{% url 'update-company' c.pk %}">
        <span class="fa fa-pencil">Güncelle {{ c.name }}</span>
      </button>
      <!-- Delete book buttons -->
      <button type="button" id="delete-book" class="bs-modal btn btn-sm btn-danger" data-form-url="{% url 'delete-company' c.pk %}">
        <span class="fa fa-trash">{{ c.name }}</span>
      </button>
    </div>
{% endfor %}
{% endblock %}

{% block javascripts %}

    <script>
        $(document).ready(function() {
            let selectedRowTemplate = "{% url 'update-company' '0' %}";
            let selectedRowId = 0;
            var DatatableBasic = (function () {
                // Variables
                var $dtBasic = $('#datatable-basic');
                // Methods
                function init($this) {
                    // Basic options. For more options check out the Datatables Docs:
                    // https://datatables.net/manual/options
                    var options = {
                        select: {
                            style: "single"
                        },
                        dom: 'lBfrtip',
                        language: {
                            paginate: {
                                previous: "<i class='fas fa-angle-left'>",
                                next: "<i class='fas fa-angle-right'>"
                            }
                        },
                        processing: true,
                        serverSide: true,
                        {#scrollX: true,#}
                        {#responsive: false,#}
                        minLength: 2,
                        order: [],
                        buttons: [
                            {
                                className: 'create-company',
                                text: 'Yeni Firma',
                            },
                            {
                                className: 'bs-modal btn btn-primary update-company-modal',
                                text: 'Düzenle',
                            },
                            "copy", "csv",
                        ],
                        ajax: {
                            url: "{% url 'company-list-json' %}",
                            type: "GET",
                            dataSrc: "data",
                            processing: true,
                        },
                        columns: [
                            { data: "name" },
                            { data: "phone" },
                            { data: "code" },
                            { data: "id" },
                            { data: "created_at" },
                        ]
                    };
                    // Init the datatable
                    var table = $this.on('init.dt', function () {
                        $('div.dataTables_length select').removeClass('custom-select custom-select-sm');
                    }).DataTable(options);
                }
                // Events
                if ($dtBasic.length) {
                    init($dtBasic);
                }

            })();

            $('#datatable-basic tbody').on('click', 'tr', function () {
                alert(DatatableBasic.row(this).data());
                selectedRowId = this.id;
            });

            $('.update-company-modal').click(() => {
                if (selectedRowId === 0) {
                    alert("Düzenlemek için bir sütun seçiniz!")
                    return false;
                }
                alert(selectedRowId);
                $(this).modalForm({
                    //TODO convert it to jinja -> {.%url%.}
                    formURL: `update/${selectedRowId}`
                });
            });

            $(".update-company-modal").attr("data-form-url", selectedRowTemplate).removeAttr("type tabindex aria-controls");
            {#$('.dataTables_length select').select2({minimumResultsForSearch: Infinity, width: ''});#}
            $(".bs-modal").each(function () {
                $(this).modalForm({
                    formURL: $(this).data('form-url')
                });
            });

            $(".create-company").modalForm({
                formURL: "{% url 'create-company' %}"
            });

        });

    </script>

{% endblock %}